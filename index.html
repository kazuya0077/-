<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>理学療法士による受診勧奨サポート問診フォーム</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body data-apps-script-url="">
    <div class="page">
      <header class="header">
        <h1>理学療法士による受診勧奨サポート問診フォーム</h1>
        <p>
          本フォームは理学療法士が生活機能や身体状況を把握し、必要に応じて医療機関受診を勧奨するための情報整理を目的としています。
        </p>
      </header>
      <div class="layout">
        <aside class="sidebar" aria-label="フォームナビゲーション">
          <div class="sidebar-card">
            <h2>セクションナビ</h2>
            <ol id="sectionNav" class="section-nav" aria-label="フォームセクション一覧"></ol>
          </div>
          <div class="sidebar-card">
            <h2>入力進捗</h2>
            <progress id="formProgress" max="100" value="0" aria-describedby="progressValue"></progress>
            <p id="progressValue" class="progress-value">0% 完了（必須項目）</p>
            <p class="progress-note">必須項目の入力状況をリアルタイムに表示します。</p>
          </div>
          <div class="sidebar-card sidebar-note">
            <h2>保存と管理</h2>
            <p>
              入力内容はブラウザに自動保存されます。共有端末をご利用の際は送信後に保存データをクリアしてください。
            </p>
            <button type="button" id="clearStorage" class="ghost-button">保存データを削除</button>
            <p id="lastSaved" class="last-saved" aria-live="polite"></p>
          </div>
        </aside>
        <main>
          <form id="questionnaireForm" class="card" autocomplete="on">
            <section data-section>
              <h2>基本情報</h2>
              <div class="grid">
                <label>
                  氏名
                  <input type="text" name="name" placeholder="例：山田 太郎" required />
                </label>
                <label>
                  ふりがな
                  <input type="text" name="name_kana" placeholder="例：やまだ たろう" />
                </label>
                <label>
                  生年月日
                  <input
                    type="text"
                    name="birthdate"
                    inputmode="numeric"
                    pattern="\d{4}[-\/]?\d{2}[-\/]?\d{2}"
                    placeholder="例：19801224 または 1980-12-24"
                    aria-describedby="birthdateHint"
                  />
                  <span id="birthdateHint" class="field-hint">数字で入力できます（西暦8桁）</span>
                </label>
                <label>
                  年齢
                  <input type="number" name="age" min="0" max="120" readonly aria-live="polite" />
                  <span class="field-hint">生年月日から自動計算されます</span>
                </label>
                <label>
                  身長（cm）
                  <input type="number" name="height_cm" min="50" max="220" step="0.1" />
                </label>
                <label>
                  体重（kg）
                  <input type="number" name="weight_kg" min="20" max="200" step="0.1" />
                </label>
                <label>
                  BMI
                  <input type="number" name="bmi" min="10" max="60" step="0.1" readonly />
                  <span class="field-hint">身長と体重を入力すると自動計算されます</span>
                </label>
                <label>
                  性別
                  <select name="sex" required>
                    <option value="" disabled selected>選択してください</option>
                    <option value="男性">男性</option>
                    <option value="女性">女性</option>
                    <option value="その他">その他</option>
                    <option value="回答しない">回答しない</option>
                  </select>
                </label>
                <label>
                  介護度
                  <select name="care_level" required>
                    <option value="" disabled selected>選択してください</option>
                    <option value="自立">自立</option>
                    <option value="要支援1">要支援1</option>
                    <option value="要支援2">要支援2</option>
                    <option value="要介護1">要介護1</option>
                    <option value="要介護2">要介護2</option>
                    <option value="要介護3">要介護3</option>
                    <option value="要介護4">要介護4</option>
                    <option value="要介護5">要介護5</option>
                  </select>
                </label>
                <label class="wide">
                  同居家族・支援者
                  <input type="text" name="household" placeholder="例：妻・長女（週1回支援）" />
                </label>
              </div>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">次のセクションへ</button>
              </div>
            </section>

            <section data-section>
              <h2>相談・支援の目的</h2>
              <div class="grid">
                <label class="wide">
                  現在困っていること・気になる症状
                  <textarea name="current_issues" rows="3"></textarea>
                </label>
                <label class="wide">
                  受診勧奨を検討している症状・事柄
                  <textarea name="target_symptoms" rows="3"></textarea>
                </label>
                <label class="wide">
                  支援のきっかけ
                  <select name="support_trigger">
                    <option value="" disabled selected>選択してください</option>
                    <option value="他職種からの紹介">他職種からの紹介</option>
                    <option value="本人・家族からの相談">本人・家族からの相談</option>
                    <option value="地域包括支援センター等からの依頼">地域包括支援センター等からの依頼</option>
                    <option value="その他">その他</option>
                  </select>
                </label>
                <label class="wide" data-conditional="support_trigger:その他">
                  その他（支援のきっかけ）
                  <input type="text" name="support_trigger_other" />
                </label>
              </div>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">次のセクションへ</button>
              </div>
            </section>

            <section data-section>
              <h2>これまでの病気やけが</h2>
              <div class="grid">
                <fieldset class="option-grid" data-option-group>
                  <legend>既往歴（当てはまるものを選択）</legend>
                  <div class="chip-grid" role="group" aria-label="既往歴">
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="特になし" data-exclusive />
                      <span>特になし</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="高血圧" />
                      <span>高血圧</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="糖尿病" />
                      <span>糖尿病</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="脂質異常症" />
                      <span>脂質異常症</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="心臓の病気" />
                      <span>心臓の病気</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="脳卒中" />
                      <span>脳卒中・TIA</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="整形外科疾患" />
                      <span>整形外科疾患</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="骨粗しょう症" />
                      <span>骨粗しょう症</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="慢性腰痛" />
                      <span>慢性腰痛</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="呼吸器疾患" />
                      <span>呼吸器疾患</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="腎臓病" />
                      <span>腎臓病</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="がん" />
                      <span>がん治療歴</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="神経筋疾患" />
                      <span>神経・筋疾患</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="認知症" />
                      <span>認知症・MCI</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="うつ・不安障害" />
                      <span>うつ・不安障害</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="medical_history" value="その他" />
                      <span>その他</span>
                    </label>
                  </div>
                  <p class="field-hint">複数選択できます。該当する主なものを選んでください。</p>
                </fieldset>
                <label class="wide" data-conditional="medical_history:その他">
                  その他の病気やけが
                  <textarea name="medical_history_other" rows="2"></textarea>
                </label>
                <label class="wide">
                  入院や手術の経験（年代や内容など）
                  <textarea name="hospital_history" rows="2"></textarea>
                </label>
              </div>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">次のセクションへ</button>
              </div>
            </section>

            <section data-section>
              <h2>服用しているもの</h2>
              <div class="grid">
                <label class="wide">
                  現在飲んでいる薬やサプリメント
                  <textarea name="current_medications" rows="3"></textarea>
                </label>
                <label>
                  お薬の管理方法
                  <select name="medication_management">
                    <option value="" disabled selected>選択してください</option>
                    <option value="本人">本人</option>
                    <option value="家族">家族</option>
                    <option value="その他">その他</option>
                  </select>
                </label>
                <label data-conditional="medication_management:その他">
                  その他のお薬の管理方法
                  <input type="text" name="medication_management_other" />
                </label>
                <label class="wide">
                  食べ物や薬で気になること
                  <textarea name="allergies" rows="3"></textarea>
                </label>
              </div>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">次のセクションへ</button>
              </div>
            </section>

            <section data-section>
              <h2>健診の受診状況</h2>
              <div class="grid">
                <label>
                  一般健診（過去1年）
                  <select name="general_checkup" required>
                    <option value="" disabled selected>選択してください</option>
                    <option value="受診済">受診済</option>
                    <option value="未受診">未受診</option>
                  </select>
                </label>
                <label data-conditional="general_checkup:受診済">
                  実施日
                  <input type="date" name="general_checkup_date" />
                </label>
                <label>
                  特定健診・特定保健指導（過去1年）
                  <select name="specific_checkup">
                    <option value="" disabled selected>選択してください</option>
                    <option value="受診済">受診済</option>
                    <option value="未受診">未受診</option>
                  </select>
                </label>
                <label data-conditional="specific_checkup:受診済">
                  実施日
                  <input type="date" name="specific_checkup_date" />
                </label>
                <label class="wide" data-conditional="general_checkup:未受診,specific_checkup:未受診">
                  受診できていない理由や予定
                  <textarea name="checkup_reason" rows="2"></textarea>
                </label>
              </div>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">次のセクションへ</button>
              </div>
            </section>

            <section data-section>
              <h2>転倒に関する質問</h2>
              <div class="grid">
                <fieldset class="schema-group">
                  <legend>3KQ：転倒リスクの3つのキークエスチョン</legend>
                  <p class="schema-note">
                    CDC STEADI プログラムで推奨される3KQ（Three Key Questions）をもとに、転倒リスクを簡易スクリーニングします。
                  </p>
                  <div class="schema-grid" role="group" aria-label="3KQ">
                    <div class="schema-item">
                      <p>過去1年の間に転倒したことがありますか？</p>
                      <div class="option-row">
                        <label class="chip">
                          <input type="radio" name="3kq_fall_history" value="はい" required />
                          <span>はい</span>
                        </label>
                        <label class="chip">
                          <input type="radio" name="3kq_fall_history" value="いいえ" />
                          <span>いいえ</span>
                        </label>
                      </div>
                    </div>
                    <div class="schema-item">
                      <p>歩いたり立っている時に不安定だと感じますか？</p>
                      <div class="option-row">
                        <label class="chip">
                          <input type="radio" name="3kq_unsteady" value="はい" required />
                          <span>はい</span>
                        </label>
                        <label class="chip">
                          <input type="radio" name="3kq_unsteady" value="いいえ" />
                          <span>いいえ</span>
                        </label>
                      </div>
                    </div>
                    <div class="schema-item">
                      <p>転倒することが心配ですか？</p>
                      <div class="option-row">
                        <label class="chip">
                          <input type="radio" name="3kq_fear" value="はい" required />
                          <span>はい</span>
                        </label>
                        <label class="chip">
                          <input type="radio" name="3kq_fear" value="いいえ" />
                          <span>いいえ</span>
                        </label>
                      </div>
                    </div>
                  </div>
                  <label data-conditional="3kq_fall_history:はい,3kq_unsteady:はい,3kq_fear:はい">
                    3KQで「はい」と答えた項目の具体的な状況
                    <textarea
                      name="3kq_detail"
                      rows="2"
                      placeholder="例：夜間トイレに行く際に転倒／杖なしではふらつく など"
                    ></textarea>
                  </label>
                </fieldset>
                <label>
                  過去1年の転倒回数
                  <input type="number" name="fall_count" min="0" />
                </label>
                <label>
                  転倒で受診やけがをしたか
                  <select name="fall_injury">
                    <option value="" disabled selected>選択してください</option>
                    <option value="なし">なし</option>
                    <option value="あり">あり</option>
                  </select>
                </label>
                <label data-conditional="fall_injury:あり" class="wide">
                  受診内容やけがの様子
                  <textarea name="fall_injury_detail" rows="2"></textarea>
                </label>
                <label>
                  転倒への不安の程度
                  <select name="fall_fear">
                    <option value="" disabled selected>選択してください</option>
                    <option value="なし">なし</option>
                    <option value="少しある">少しある</option>
                    <option value="強くある">強くある</option>
                  </select>
                </label>
                <label>
                  屋内移動への自信（0〜10）
                  <div class="range-wrapper">
                    <input type="range" name="indoor_confidence" min="0" max="10" value="5" data-output="indoor_confidence_output" />
                    <output id="indoor_confidence_output">5</output>
                  </div>
                </label>
                <label>
                  屋外移動への自信（0〜10）
                  <div class="range-wrapper">
                    <input type="range" name="outdoor_confidence" min="0" max="10" value="5" data-output="outdoor_confidence_output" />
                    <output id="outdoor_confidence_output">5</output>
                  </div>
                </label>
                <label class="wide">
                  歩行補助具・介護用具
                  <textarea name="assistive_devices" rows="2"></textarea>
                </label>
                <label class="wide">
                  転倒予防の取組
                  <textarea name="fall_prevention" rows="2"></textarea>
                </label>
              </div>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">次のセクションへ</button>
              </div>
            </section>

            <section data-section>
              <h2>生活習慣（睡眠・食事）</h2>
              <div class="grid">
                <label>
                  睡眠のようす
                  <select name="sleep_quality">
                    <option value="" disabled selected>選択してください</option>
                    <option value="熟睡できている">熟睡できている</option>
                    <option value="寝つきが悪い">寝つきが悪い</option>
                    <option value="途中で目が覚める">途中で目が覚める</option>
                    <option value="早朝に目が覚める">早朝に目が覚める</option>
                    <option value="日中に眠気が強い">日中に眠気が強い</option>
                  </select>
                </label>
                <label class="wide" data-conditional="sleep_quality:寝つきが悪い,sleep_quality:途中で目が覚める,sleep_quality:早朝に目が覚める,sleep_quality:日中に眠気が強い">
                  睡眠について補足があれば記載してください
                  <textarea name="sleep_detail" rows="2"></textarea>
                </label>
                <label>
                  食事のようす
                  <select name="nutrition">
                    <option value="" disabled selected>選択してください</option>
                    <option value="1日3食とれている">1日3食とれている</option>
                    <option value="食事量が少ない">食事量が少ない</option>
                    <option value="偏食がある">偏食がある</option>
                    <option value="むせ込みが気になる">むせ込みが気になる</option>
                    <option value="食欲がない">食欲がない</option>
                  </select>
                </label>
                <label class="wide" data-conditional="nutrition:食事量が少ない,nutrition:偏食がある,nutrition:むせ込みが気になる,nutrition:食欲がない">
                  食生活について補足があれば記載してください
                  <textarea name="nutrition_detail" rows="2"></textarea>
                </label>
                <label>
                  1日の水分量の目安
                  <select name="hydration">
                    <option value="" disabled selected>選択してください</option>
                    <option value="1L未満">1L未満</option>
                    <option value="1〜1.5L">1〜1.5L</option>
                    <option value="1.5〜2L">1.5〜2L</option>
                    <option value="2L以上">2L以上</option>
                  </select>
                </label>
              </div>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">次のセクションへ</button>
              </div>
            </section>

            <section data-section>
              <h2>しびれ・感覚の気になる部位</h2>
              <div class="grid">
                <div class="body-map-card">
                  <h3 class="body-map-card__title">ボディマップで部位を選択</h3>
                  <p class="field-hint" id="bodyMapHint">タップまたはクリックで左右別に選択できます。再度押すと解除されます。</p>
                  <div class="body-map" data-body-map aria-describedby="bodyMapHint">
                    <div class="body-map__figures">
                      <div class="body-map__figure-wrapper" data-figure="front">
                        <svg viewBox="0 0 180 520" class="body-map__svg" aria-hidden="true" focusable="false">
                          <g class="body-map__figure">
                            <circle cx="90" cy="52" r="38"></circle>
                            <rect x="62" y="92" width="56" height="120" rx="26"></rect>
                            <rect x="44" y="212" width="92" height="120" rx="40"></rect>
                            <rect x="30" y="332" width="120" height="150" rx="50"></rect>
                            <rect x="12" y="152" width="32" height="120" rx="16"></rect>
                            <rect x="136" y="152" width="32" height="120" rx="16"></rect>
                            <rect x="36" y="470" width="48" height="60" rx="20"></rect>
                            <rect x="96" y="470" width="48" height="60" rx="20"></rect>
                          </g>
                        </svg>
                        <div class="body-map__areas">
                          <button type="button" class="body-map__area" data-area="頭部（左）" style="--x:-54; --y:18;" aria-label="頭部（左）"></button>
                          <button type="button" class="body-map__area" data-area="頭部（右）" style="--x:54; --y:18;" aria-label="頭部（右）"></button>
                          <button type="button" class="body-map__area" data-area="首（左）" style="--x:-44; --y:94;" aria-label="首（左）"></button>
                          <button type="button" class="body-map__area" data-area="首（右）" style="--x:44; --y:94;" aria-label="首（右）"></button>
                          <button type="button" class="body-map__area" data-area="肩（左）" style="--x:-92; --y:130;" aria-label="肩（左）"></button>
                          <button type="button" class="body-map__area" data-area="肩（右）" style="--x:92; --y:130;" aria-label="肩（右）"></button>
                          <button type="button" class="body-map__area" data-area="上腕（左）" style="--x:-84; --y:170;" aria-label="上腕（左）"></button>
                          <button type="button" class="body-map__area" data-area="上腕（右）" style="--x:84; --y:170;" aria-label="上腕（右）"></button>
                          <button type="button" class="body-map__area" data-area="前腕・手（左）" style="--x:-88; --y:242;" aria-label="前腕・手（左）"></button>
                          <button type="button" class="body-map__area" data-area="前腕・手（右）" style="--x:88; --y:242;" aria-label="前腕・手（右）"></button>
                          <button type="button" class="body-map__area" data-area="体幹（前面）" style="--x:0; --y:190;" aria-label="体幹（前面）"></button>
                          <button type="button" class="body-map__area" data-area="腰・骨盤（左）" style="--x:-54; --y:300;" aria-label="腰・骨盤（左）"></button>
                          <button type="button" class="body-map__area" data-area="腰・骨盤（右）" style="--x:54; --y:300;" aria-label="腰・骨盤（右）"></button>
                          <button type="button" class="body-map__area" data-area="股関節・太もも（左）" style="--x:-34; --y:348;" aria-label="股関節・太もも（左）"></button>
                          <button type="button" class="body-map__area" data-area="股関節・太もも（右）" style="--x:34; --y:348;" aria-label="股関節・太もも（右）"></button>
                          <button type="button" class="body-map__area" data-area="膝まわり（左）" style="--x:-30; --y:410;" aria-label="膝まわり（左）"></button>
                          <button type="button" class="body-map__area" data-area="膝まわり（右）" style="--x:30; --y:410;" aria-label="膝まわり（右）"></button>
                          <button type="button" class="body-map__area" data-area="ふくらはぎ（左）" style="--x:-22; --y:456;" aria-label="ふくらはぎ（左）"></button>
                          <button type="button" class="body-map__area" data-area="ふくらはぎ（右）" style="--x:22; --y:456;" aria-label="ふくらはぎ（右）"></button>
                          <button type="button" class="body-map__area" data-area="足首・足指（左）" style="--x:-26; --y:504;" aria-label="足首・足指（左）"></button>
                          <button type="button" class="body-map__area" data-area="足首・足指（右）" style="--x:26; --y:504;" aria-label="足首・足指（右）"></button>
                        </div>
                      </div>
                      <div class="body-map__figure-wrapper" data-figure="back">
                        <svg viewBox="0 0 180 520" class="body-map__svg" aria-hidden="true" focusable="false">
                          <g class="body-map__figure">
                            <circle cx="90" cy="52" r="38"></circle>
                            <rect x="62" y="92" width="56" height="120" rx="26"></rect>
                            <rect x="44" y="212" width="92" height="120" rx="40"></rect>
                            <rect x="30" y="332" width="120" height="150" rx="50"></rect>
                            <rect x="12" y="152" width="32" height="120" rx="16"></rect>
                            <rect x="136" y="152" width="32" height="120" rx="16"></rect>
                            <rect x="36" y="470" width="48" height="60" rx="20"></rect>
                            <rect x="96" y="470" width="48" height="60" rx="20"></rect>
                          </g>
                        </svg>
                        <div class="body-map__areas">
                          <button type="button" class="body-map__area" data-area="頭部（左）" style="--x:-54; --y:18;" aria-label="頭部（左・背面）"></button>
                          <button type="button" class="body-map__area" data-area="頭部（右）" style="--x:54; --y:18;" aria-label="頭部（右・背面）"></button>
                          <button type="button" class="body-map__area" data-area="首（左）" style="--x:-44; --y:94;" aria-label="首（左・背面）"></button>
                          <button type="button" class="body-map__area" data-area="首（右）" style="--x:44; --y:94;" aria-label="首（右・背面）"></button>
                          <button type="button" class="body-map__area" data-area="肩（左）" style="--x:-92; --y:130;" aria-label="肩（左・背面）"></button>
                          <button type="button" class="body-map__area" data-area="肩（右）" style="--x:92; --y:130;" aria-label="肩（右・背面）"></button>
                          <button type="button" class="body-map__area" data-area="上腕（左）" style="--x:-84; --y:170;" aria-label="上腕（左・背面）"></button>
                          <button type="button" class="body-map__area" data-area="上腕（右）" style="--x:84; --y:170;" aria-label="上腕（右・背面）"></button>
                          <button type="button" class="body-map__area" data-area="前腕・手（左）" style="--x:-88; --y:242;" aria-label="前腕・手（左・背面）"></button>
                          <button type="button" class="body-map__area" data-area="前腕・手（右）" style="--x:88; --y:242;" aria-label="前腕・手（右・背面）"></button>
                          <button type="button" class="body-map__area" data-area="体幹（後面）" style="--x:0; --y:190;" aria-label="体幹（後面）"></button>
                          <button type="button" class="body-map__area" data-area="腰・骨盤（左）" style="--x:-54; --y:300;" aria-label="腰・骨盤（左・背面）"></button>
                          <button type="button" class="body-map__area" data-area="腰・骨盤（右）" style="--x:54; --y:300;" aria-label="腰・骨盤（右・背面）"></button>
                          <button type="button" class="body-map__area" data-area="股関節・太もも（左）" style="--x:-34; --y:348;" aria-label="股関節・太もも（左・背面）"></button>
                          <button type="button" class="body-map__area" data-area="股関節・太もも（右）" style="--x:34; --y:348;" aria-label="股関節・太もも（右・背面）"></button>
                          <button type="button" class="body-map__area" data-area="膝まわり（左）" style="--x:-30; --y:410;" aria-label="膝まわり（左・背面）"></button>
                          <button type="button" class="body-map__area" data-area="膝まわり（右）" style="--x:30; --y:410;" aria-label="膝まわり（右・背面）"></button>
                          <button type="button" class="body-map__area" data-area="ふくらはぎ（左）" style="--x:-22; --y:456;" aria-label="ふくらはぎ（左・背面）"></button>
                          <button type="button" class="body-map__area" data-area="ふくらはぎ（右）" style="--x:22; --y:456;" aria-label="ふくらはぎ（右・背面）"></button>
                          <button type="button" class="body-map__area" data-area="足首・足指（左）" style="--x:-26; --y:504;" aria-label="足首・足指（左・背面）"></button>
                          <button type="button" class="body-map__area" data-area="足首・足指（右）" style="--x:26; --y:504;" aria-label="足首・足指（右・背面）"></button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="body-map__selection" data-body-map-selection aria-live="polite"></div>
                </div>
                <fieldset class="option-grid body-map-options" data-option-group>
                  <legend>症状が気になる部位（複数選択可）</legend>
                  <div class="chip-grid">
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="特に気になる部位はない" data-exclusive data-body-area />
                      <span>特に気になる部位はない</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="頭部（左）" data-body-area />
                      <span>頭部（左）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="頭部（右）" data-body-area />
                      <span>頭部（右）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="首（左）" data-body-area />
                      <span>首（左）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="首（右）" data-body-area />
                      <span>首（右）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="肩（左）" data-body-area />
                      <span>肩（左）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="肩（右）" data-body-area />
                      <span>肩（右）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="上腕（左）" data-body-area />
                      <span>上腕（左）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="上腕（右）" data-body-area />
                      <span>上腕（右）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="前腕・手（左）" data-body-area />
                      <span>前腕・手（左）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="前腕・手（右）" data-body-area />
                      <span>前腕・手（右）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="体幹（前面）" data-body-area />
                      <span>体幹（前面）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="体幹（後面）" data-body-area />
                      <span>体幹（後面）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="腰・骨盤（左）" data-body-area />
                      <span>腰・骨盤（左）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="腰・骨盤（右）" data-body-area />
                      <span>腰・骨盤（右）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="股関節・太もも（左）" data-body-area />
                      <span>股関節・太もも（左）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="股関節・太もも（右）" data-body-area />
                      <span>股関節・太もも（右）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="膝まわり（左）" data-body-area />
                      <span>膝まわり（左）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="膝まわり（右）" data-body-area />
                      <span>膝まわり（右）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="ふくらはぎ（左）" data-body-area />
                      <span>ふくらはぎ（左）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="ふくらはぎ（右）" data-body-area />
                      <span>ふくらはぎ（右）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="足首・足指（左）" data-body-area />
                      <span>足首・足指（左）</span>
                    </label>
                    <label class="chip">
                      <input type="checkbox" name="sensory_areas" value="足首・足指（右）" data-body-area />
                      <span>足首・足指（右）</span>
                    </label>
                  </div>
                  <p class="field-hint">体の図またはボタンを使って選択できます。特にない場合は「特に気になる部位はない」を選んでください。</p>
                </fieldset>
                <label>
                  しびれ・感覚の特徴
                  <select name="sensory_quality">
                    <option value="" disabled selected>選択してください</option>
                    <option value="ピリピリする">ピリピリする</option>
                    <option value="じんじんする">じんじんする</option>
                    <option value="感覚が鈍い">感覚が鈍い</option>
                    <option value="触ると違和感がある">触ると違和感がある</option>
                    <option value="その他">その他</option>
                  </select>
                </label>
                <label class="wide" data-conditional="sensory_quality:その他">
                  その他の感じ方
                  <input type="text" name="sensory_quality_other" />
                </label>
                <label class="wide">
                  日時や状況など詳細
                  <textarea name="sensory_detail" rows="2"></textarea>
                </label>
              </div>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">次のセクションへ</button>
              </div>
            </section>

            <section data-section>
              <h2>体の動きや痛み</h2>
              <div class="grid">
                <label>
                  痛み（0〜10）
                  <div class="range-wrapper">
                    <input type="range" name="pain_scale" min="0" max="10" value="0" data-output="pain_scale_output" />
                    <output id="pain_scale_output">0</output>
                  </div>
                </label>
                <label class="wide">
                  痛みの場所やタイミング
                  <textarea name="pain_detail" rows="2"></textarea>
                </label>
                <label class="wide">
                  動きづらさや筋力の気になる点
                  <textarea name="mobility_strength" rows="2"></textarea>
                </label>
                <label>
                  半年以内の体重変化
                  <select name="weight_change">
                    <option value="" disabled selected>選択してください</option>
                    <option value="変化なし">変化なし</option>
                    <option value="増加傾向">増加傾向</option>
                    <option value="減少傾向">減少傾向</option>
                  </select>
                </label>
              </div>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">次のセクションへ</button>
              </div>
            </section>

            <section data-section>
              <h2>運動や身体活動の習慣（厚生労働省基準を参考）</h2>
              <p class="section-note">
                厚生労働省「健康づくりのための身体活動基準2013」を参考に、週150分以上の中等度の身体活動または75分以上の高強度運動を目指します。
              </p>
              <div class="grid">
                <label>
                  定期的な運動習慣
                  <select name="regular_exercise">
                    <option value="" disabled selected>選択してください</option>
                    <option value="なし">なし</option>
                    <option value="あり（週1〜2回）">あり（週1〜2回）</option>
                    <option value="あり（週3回以上）">あり（週3回以上）</option>
                  </select>
                </label>
                <label class="wide" data-conditional="regular_exercise:なし">
                  運動を行えない・行わない理由
                  <textarea name="exercise_barriers" rows="2"></textarea>
                </label>
                <label class="wide" data-conditional="regular_exercise:あり（週1〜2回）,regular_exercise:あり（週3回以上)">
                  運動の内容・頻度
                  <textarea name="exercise_detail" rows="2"></textarea>
                </label>
                <label>
                  1日の平均歩数
                  <select name="daily_steps">
                    <option value="" disabled selected>選択してください</option>
                    <option value="〜3,000歩">〜3,000歩</option>
                    <option value="3,001〜6,000歩">3,001〜6,000歩</option>
                    <option value="6,001〜8,000歩">6,001〜8,000歩</option>
                    <option value="8,001歩以上">8,001歩以上</option>
                  </select>
                </label>
                <label>
                  身体活動強度の目安
                  <select name="activity_intensity">
                    <option value="" disabled selected>選択してください</option>
                    <option value="1日60分未満の中等度活動">1日60分未満の中等度活動</option>
                    <option value="1日60分以上の中等度活動">1日60分以上の中等度活動</option>
                    <option value="週75分未満の高強度運動">週75分未満の高強度運動</option>
                    <option value="週75分以上の高強度運動">週75分以上の高強度運動</option>
                    <option value="中高強度の組み合わせで推奨基準達成">中高強度の組み合わせで推奨基準達成</option>
                  </select>
                </label>
                <label>
                  仕事・家事での身体負荷
                  <select name="workload">
                    <option value="" disabled selected>選択してください</option>
                    <option value="軽度（主に座位）">軽度（主に座位）</option>
                    <option value="中等度（立位・歩行が多い）">中等度（立位・歩行が多い）</option>
                    <option value="高負荷（力仕事が多い）">高負荷（力仕事が多い）</option>
                  </select>
                </label>
                <label class="wide">
                  休養・セルフケア
                  <textarea name="recovery" rows="2"></textarea>
                </label>
              </div>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">次のセクションへ</button>
              </div>
            </section>

            <section data-section>
              <h2>こころの状態</h2>
              <div class="grid">
                <label class="wide">
                  気分の変化やストレス
                  <textarea name="mood_changes" rows="2"></textarea>
                </label>
                <label class="wide">
                  睡眠障害・不安・抑うつ症状
                  <textarea name="mental_symptoms" rows="2"></textarea>
                </label>
                <label class="wide">
                  専門職への相談歴
                  <textarea name="mental_health_history" rows="2"></textarea>
                </label>
                <label class="wide">
                  やる気や活動量の変化
                  <textarea name="motivation" rows="2"></textarea>
                </label>
              </div>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">次のセクションへ</button>
              </div>
            </section>

            <section data-section>
              <h2>理学療法士メモ</h2>
              <div class="grid">
                <label class="wide">
                  姿勢・歩行・バランスの所見
                  <textarea name="pt_observations" rows="3"></textarea>
                </label>
                <label class="wide">
                  最近の測定値（血圧など）
                  <textarea name="vital_signs" rows="2"></textarea>
                </label>
                <label class="wide">
                  受診が望ましい理由
                  <textarea name="referral_reason" rows="2"></textarea>
                </label>
                <label class="wide">
                  今後共有したい専門職や機関
                  <textarea name="collaboration_targets" rows="2"></textarea>
                </label>
                <label class="wide">
                  本人・家族への説明内容と反応
                  <textarea name="family_feedback" rows="2"></textarea>
                </label>
                <label class="wide">
                  その他のメモ
                  <textarea name="additional_notes" rows="2"></textarea>
                </label>
              </div>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">次のセクションへ</button>
              </div>
            </section>

            <section data-section>
              <h2>同意確認</h2>
              <label class="checkbox">
                <input type="checkbox" name="consent" value="同意済" required />
                <span>本フォームで収集した情報を受診勧奨および支援調整の目的に使用することに同意します。</span>
              </label>
              <div class="section-controls">
                <button type="button" class="ghost-button" data-step="prev">前のセクションへ</button>
                <button type="button" class="primary-button" data-step="next">確認画面へ</button>
              </div>
            </section>

            <div class="actions" hidden>
              <button type="button" id="previewButton" class="ghost-button">入力内容をプレビュー</button>
              <button type="submit" class="primary-button">Googleスプレッドシートに送信</button>
              <p id="statusMessage" role="status" aria-live="polite"></p>
            </div>
          </form>
        </main>
      </div>
    </div>

    <div id="previewModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
      <div class="modal__overlay" data-close-preview></div>
      <div class="modal__content" role="document">
        <button type="button" class="modal__close" id="closePreview" aria-label="プレビューを閉じる">×</button>
        <h2>入力内容プレビュー</h2>
        <p class="modal-note">送信前に内容をご確認ください。内容はブラウザに保存されています。</p>
        <div id="previewContent" class="preview-content" aria-live="polite"></div>
        <div class="modal-actions">
          <button type="button" class="ghost-button" id="closePreviewFooter">閉じる</button>
          <button type="submit" form="questionnaireForm" class="primary-button">この内容で送信</button>
        </div>
      </div>
    </div>

    <script src="config.js"></script>
    <script src="script.js" type="module"></script>
  </body>
</html>
